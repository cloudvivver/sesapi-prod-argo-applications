apiVersion: v1
data:
  # Application URLs
  APP_BASE_URL: https://saude.devel.saude.pi.gov.br
  APP_HOST: saude.devel.saude.pi.gov.br
  REPORT_SERVICE_URL: "https://event-agent.bigdatasys.net/api/events/report"
  WEBSOCKET_NOTIFICATION_URL: "wss://notificacao.bigdatasys.net/ws/relatorios"
  WEBSOCKET_NOTIFICATION_ORIGIN: "saude-devel"

  # Redis Configuration (non-sensitive)
  REDIS_HOST: redis
  REDIS_PORT: "6379"
  REDIS_DB: "0"
  REDIS_MAXMEMORY_POLICY: "allkeys-lfu"
  REDIS_TIMEOUT: "1"

  # Database Configuration (non-sensitive)
  # AWS RDS PostgreSQL 16.10
  DATABASE_HOST: db-viverdb.cb8m6qcy2cyh.sa-east-1.rds.amazonaws.com
  DATABASE_PORT: "5432"
  DATABASE_PROD: saude_devel_pi
  DATABASE_POOL: "10"
  DATABASE_BI_SESAPI: ""

  # Database Optimizations
  DATABASE_INCLUDES_CACHE: "enabled"
  DATABASE_TIMEOUT: "5000"           # 5s timeout
  DATABASE_CHECKOUT_TIMEOUT: "5000"  # 5s checkout timeout
  DATABASE_REAPING_FREQUENCY: "60"   # Limpa connections a cada 60s
  DATABASE_STATEMENT_LIMIT: "1000"   # Limita prepared statements

  # Bundle Configuration
  BUNDLE_JOBS: "4"
  BUNDLE_RETRY: "3"

  # Rails Configuration
  RAILS_MAX_THREADS: "8"
  RAILS_SERVE_STATIC_FILES: "true"
  RAILS_STATIC_CACHE_CONTROL: "public, max-age=31536000, immutable"

  # Rails Cache Optimizations
  RAILS_ACTION_CACHE: "true"
  RAILS_FRAGMENT_CACHE: "true"
  RAILS_CACHE_STORE: "configured"
  RAILS_CACHE_EXPIRES_IN: "configured"
  RAILS_DESKTOP_CACHE_TTL: "configured"

  # Worker Configuration
  WEB_CONCURRENCY: "2"
  SIDEKIQ_CONCURRENCY: "2"

  # External Services (non-sensitive)
  HYDRA_HOST: "https://regulahm.saude.pi.gov.br"

kind: ConfigMap
metadata:
  labels:
    io.kompose.service: pgweb-env
  name: env
  namespace: saude-homolog
